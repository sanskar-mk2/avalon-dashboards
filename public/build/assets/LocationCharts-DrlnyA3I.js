import{r as g,j as F,p as D,s as N,q as I,g as i,o as c,b as a,F as O,x as B,y as R,a as E,w as A,d as U,t as j,u as L,l as W}from"./app-B2GYkFaq.js";import{C as v,p as T,t as V,a as z}from"./chartjs-plugin-datalabels.esm-Fgtg15OK.js";const G={class:"flex justify-center flex-wrap sm:flex-nowrap mt-10 gap-8"},M={class:"sm:basis-1/3 w-full mx-4 sm:mx-0 card bg-base-100 p-4"},q={class:"flex justify-center"},H={key:0,class:"text-center py-12 text-base-content/50"},P={class:"sm:basis-1/3 w-full mx-4 sm:mx-0 card bg-base-100 p-4"},J={class:"flex justify-center"},K={key:0,class:"text-center py-12 text-base-content/50"},Q={class:"sm:basis-1/3 w-full mx-4 sm:mx-0 card bg-base-100 p-4"},X={key:0,class:"text-center py-12 text-base-content/50"},Y={key:1,class:"h-full sm:h-[250px] overflow-y-auto"},Z={class:"min-w-full bg-base-100 border border-base-250 rounded-lg overflow-hidden"},$={class:"divide-y divide-base-250"},tt={class:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-base-content"},et={class:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-base-content"},nt={__name:"LocationCharts",props:{location_chart_data:Object,top_sales_by_location:Object,month:String,additional_filters:Object},setup(w){v.register(T);const l=w,h=g(null),_=g(null);let m=null,u=null;const f=g(null),C=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}),b=F(()=>{var o,e,s;return((s=(e=(o=l.location_chart_data)==null?void 0:o.sales_by_location)==null?void 0:e.labels)==null?void 0:s.length)>0}),k=F(()=>{const o=V[f.value];if(!o)return{};const e=Object.keys(o).filter(r=>!r.startsWith("--")&&r!=="color-scheme"&&r!=="fontFamily"),s={};return e.forEach(r=>{s[r]=new z(o[r]).toGamut({space:"srgb"}).to("srgb").toString({format:"hex"})}),s}),x=()=>{if(m&&(m.destroy(),m=null),u&&(u.destroy(),u=null),!b.value||!h.value||!_.value)return;const o=Object.keys(k.value).filter(t=>t!=="base-100"&&t!=="base-200"&&t!=="base-250"&&t!=="secondary-content").map(t=>k.value[t]),e={labels:l.location_chart_data.sales_by_location.labels,datasets:[{data:l.location_chart_data.sales_by_location.datasets[0].data,backgroundColor:o.map(t=>t+"80"),borderColor:o,borderWidth:1}]},s={labels:l.location_chart_data.gp_by_location.labels,datasets:[{data:l.location_chart_data.gp_by_location.datasets[0].data,backgroundColor:o.map(t=>t+"80"),borderColor:o,borderWidth:1}]},r={responsive:!1,width:250,height:250,maintainAspectRatio:!0,onHover:(t,n)=>{t.native.target.style.cursor=n.length?"pointer":"default"},onClick:(t,n,p)=>{if(n.length>0){const d=n[0].index,y=p.data.labels[d],S={"filter[location]":l.location_chart_data.location_abbrevation_mapping[y],"filter[period]":l.month,...l.additional_filters};R.get(route("sales.index"),S)}},plugins:{legend:{labels:{font:{size:10},boxWidth:10}},tooltip:{callbacks:{label:function(t){const n=t.raw;return C.format(n)}}},datalabels:{color:"white",formatter:function(t,n){const p=n.chart.data.labels[n.dataIndex],d=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0,notation:"compact"});return p+`
`+d.format(t)},backgroundColor:function(t){return t.dataset.borderColor[t.dataIndex]},textAlign:"center",borderRadius:4,padding:4,font:{weight:"bold",size:10},display:function(t){const n=t.dataset.data;return n[t.dataIndex]>n.reduce((d,y)=>parseFloat(d)+parseFloat(y))*.05}}}};m=new v(h.value,{type:"pie",data:e,options:r}),u=new v(_.value,{type:"pie",data:s,options:r})};return new MutationObserver(o=>{o.some(e=>e.attributeName==="data-theme")&&(f.value=document.documentElement.getAttribute("data-theme"),x())}).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),D(()=>l.location_chart_data,()=>{N(()=>{x()})},{deep:!0}),I(()=>{f.value=document.documentElement.getAttribute("data-theme"),x()}),(o,e)=>(c(),i("div",G,[a("div",M,[e[0]||(e[0]=a("h2",{class:"text-lg sm:text-xl font-semibold mb-4"}," Sales By Location ",-1)),a("div",q,[b.value?(c(),i("canvas",{key:1,ref_key:"locationChartRef",ref:h,width:"250",height:"250"},null,512)):(c(),i("div",H," No data available "))])]),a("div",P,[e[1]||(e[1]=a("h2",{class:"text-lg sm:text-xl font-semibold mb-4"}," GP By Location ",-1)),a("div",J,[b.value?(c(),i("canvas",{key:1,ref_key:"gpLocationChartRef",ref:_,width:"250",height:"250"},null,512)):(c(),i("div",K," No data available "))])]),a("div",Q,[e[3]||(e[3]=a("h2",{class:"text-lg sm:text-xl font-semibold mb-4"}," Sales By Location ",-1)),b.value?(c(),i("div",Y,[a("table",Z,[e[2]||(e[2]=a("thead",{class:"bg-primary sticky top-0"},[a("tr",null,[a("th",{class:"px-4 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-primary-content uppercase tracking-wider"}," Location "),a("th",{class:"px-4 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-primary-content uppercase tracking-wider"}," Sales ")])],-1)),a("tbody",$,[(c(!0),i(O,null,B(w.top_sales_by_location,s=>(c(),i("tr",{key:s.id,class:"hover:bg-base-200"},[a("td",tt,[E(L(W),{href:o.route("locations.show",s.location_model.id),class:"link"},{default:A(()=>[U(j(s.location_model.location_abbreviation),1)]),_:2},1032,["href"])]),a("td",et,j(L(C).format(s.total_sales)),1)]))),128))])])])):(c(),i("div",X," No data available "))])]))}};export{nt as _};
